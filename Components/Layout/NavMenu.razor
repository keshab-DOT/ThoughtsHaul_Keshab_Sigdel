@using MauiApp1.Services
@inject AppState State
@implements IDisposable
@inject NavigationManager Nav

<div class="flex flex-col h-full bg-[#f8f9fa] dark:bg-[#050505] border-r border-gray-200 dark:border-white/10 py-12 px-6 transition-colors duration-300">

    <div class="mb-16">
        <div class="flex items-center gap-2 mb-4">
            <h1 class="ml-2 text-2xl font-black text-red-600 tracking-tighter @(State.IsDarkMode ? "text-white" : "text-black")">ThoughtHaul</h1>
        </div>
    </div>

    <nav class="flex flex-col flex-1 gap-2">
        @* Dashboard *@
        <NavLink href="/" Match="NavLinkMatch.All" class="@GetActiveClass("")">
            <i class="bi bi-grid-fill"></i> Dashboard
        </NavLink>

        @* New Entry *@
        <NavLink href="/newentry" class="@GetActiveClass("newentry")">
            <i class="bi bi-plus-lg"></i> New Entry
        </NavLink>

        @* Calendar *@
        <NavLink href="/calendar" class="@GetActiveClass("calendar")">
            <i class="bi bi-calendar3"></i> Calendar
        </NavLink>

        @* Journal *@
        <NavLink href="/journal" class="@GetActiveClass("journal")">
            <i class="bi bi-journal-text"></i> Journal
        </NavLink>

        @* Export *@
        <NavLink href="/export" class="@GetActiveClass("export")">
            <i class="bi bi-download"></i> Export
        </NavLink>

        <div class="mt-auto">
            <NavLink href="/settings" class="@GetActiveClass("settings")">
                <i class="bi bi-gear"></i> Settings
            </NavLink>
        </div>
    </nav>
</div>

@code {
    protected override void OnInitialized()
    {
        State.OnChange += StateHasChanged;
        Nav.LocationChanged += (s, e) => StateHasChanged(); // Force refresh when URL changes
    }

    // Helper method to apply Tailwind classes based on active route
    private string GetActiveClass(string pageName)
    {
        var relativePath = Nav.ToBaseRelativePath(Nav.Uri).ToLower();
        bool isActive = pageName == "" ? relativePath == "" : relativePath.StartsWith(pageName.ToLower());

        string baseClasses = "flex items-center gap-3 p-3 rounded-xl transition-all font-semibold no-underline ";

        return isActive
            ? baseClasses + "bg-slate-100 text-slate-900 shadow-sm" // Active Look
            : baseClasses + "text-slate-400 hover:text-slate-900 hover:bg-slate-50"; // Inactive Look
    }

    public void Dispose()
    {
        State.OnChange -= StateHasChanged;
    }
}
